---
slug: higher-order-component
title: React é«˜é˜¶ç»„ä»¶
author: è‚æ™“é£
author_title: æµæµªè€…
author_url: https://github.com/niexiaofei1988
author_image_url: ../static/img/avatar.jpeg
tags: [React, HOC]
---

# What ?

é«˜é˜¶ç»„ä»¶(HOC) æ˜¯ React ä¸­ ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„ä¸€ç§æŠ€å·§, è‡ªèº«ä¸æ˜¯ React API çš„ä¸€éƒ¨åˆ†, è€Œæ˜¯ä¸€ç§ç”¨äº React çš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„è®¾è®¡æ¨¡å¼,

- å¯¹äºæ™®é€šçš„ç»„ä»¶æ˜¯å°† Props ä¸­çš„æ•°æ®è½¬æ¢ä¸º UI
- é«˜é˜¶ç»„ä»¶ä¸æ˜¯ç»„ä»¶, æ¥å—ä¸€ä¸ª React ç»„ä»¶è¿”å›ä¸€ä¸ªå¢å¼ºçš„ React ç»„ä»¶(æ¯”å¦‚: æ”¹é€ æ±½è½¦), ä¸æ˜¯ç»„ä»¶è€Œæ˜¯å‡½æ•°(æ¯”å¦‚é«˜é˜¶å‡½æ•° map, reduce)

```ts
const EnhancedComponent = higherOrderComponent(WrappedComponent);
```

<!--truncate-->

# Why ?

ä¸šåŠ¡å¼€å‘ä¸­, å¤§é‡å‡ºç°ç›¸ä¼¼åº¦æé«˜çš„ç»„ä»¶æˆ–é¡µé¢, é¢‘ç¹çš„å¼€å‘å¤šä½™æ— æ•ˆä»£ç , é™ä½å¼€å‘æ•ˆç‡, ä½¿ç”¨é«˜é˜¶ç»„ä»¶å¯ä»¥è§£å†³ç±»ä¼¼ç»„ä»¶é¢‘ç¹å¼€å‘

- æŠ½å–é‡å¤é€»è¾‘: ä»£ç å¤ç”¨, é¡µé¢å¤ç”¨
- æ¡ä»¶åˆ¤æ–­(æ¸²æŸ“åŠ«æŒ): æƒé™æ§åˆ¶
- æ•è·ç”Ÿå‘½å‘¨æœŸ: æ—¥å¿—æ‰“ç‚¹, åŸ‹ç‚¹ä¸ŠæŠ¥, é”™è¯¯æ•è·ç­‰

# å®ç°é«˜é˜¶ç»„ä»¶çš„æ–¹å¼ ?

å®ç°é«˜é˜¶ç»„ä»¶åˆ†ä¸ºä¸¤ç§æ–¹å¼:

- å±æ€§ä»£ç†(props proxy): é«˜é˜¶ç»„ä»¶é€šè¿‡è¢«åŒ…è£¹çš„ `React` ç»„ä»¶æ¥æ“ä½œ `props`, ç®€å•çš„è¯´å°±æ˜¯ä¼ å…¥ä¸€ä¸ª `React` ç»„ä»¶ç»è¿‡é’ˆå¯¹ç»„ä»¶åšçš„ä¸€ç³»åˆ—å¢å¼º, æœ€ç»ˆé€šè¿‡ `render` é‡æ–°è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶
- åå‘ç»§æ‰¿(inheritance inversion): é«˜é˜¶ç»„ä»¶ç»§æ‰¿è‡ªè¢«åŒ…è£¹çš„ `React` ç»„ä»¶

## å±æ€§ä»£ç†

å±æ€§ä»£ç†æ˜¯æœ€å¸¸è§çš„å®ç°æ–¹å¼, æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨ç»„åˆçš„æ–¹å¼(å³: é’ˆå¯¹åŒ…è£¹çš„ React ç»„ä»¶åšä¸€äº›å¢å¼ºçš„å±æ€§) å¯ä»¥ç†è§£ä¸ºå¤–éƒ¨æ³¨å…¥ä¸€äº›æ–¹æ³•æˆ–è€…å±æ€§, æœ€ç»ˆå°†å¢å¼ºçš„ç»„ä»¶è¿›è¡Œè¿”å›(åœ¨ç»„ä»¶å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨æ³¨å…¥çš„ä¸€äº›æ–¹æ³•)(æ‹¼è£…æµæ°´çº¿),
é€šè¿‡å±æ€§ä»£ç†å®ç°çš„é«˜é˜¶æœ±å°±çˆ±èƒ½å’ŒåŸæ¥çš„ç»„ä»¶å±äºä¸€ä¸ªç±»ä¼¼æµæ°´çº¿çš„å·¥ä½œä¸€æ ·,ä»å…¥å£è¿›å…¥åˆå§‹çš„ç»„ä»¶ (ç»è¿‡å¤šæ¬¡å¢å¼ºå)å½¢æˆæœ€ç»ˆçš„æˆå“, è¿™ä¹Ÿä½¿å¾—è°ƒç”¨åŸå§‹ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ—¶çš„é¡ºåºä¼šæœ‰ä¸€äº›å˜åŒ–, ä¾‹å¦‚

å±æ€§ä»£ç†çš„æ–¹å¼ å¤§å¤šä¹Ÿå¯ä»¥ä½¿ç”¨ [render Props](https://zh-hans.reactjs.org/docs/render-props.html)ä»£æ›¿

import LifeCycleDemo from '@site/src/components/demos/LifeCycleDemo';

<LifeCycleDemo />

### 1. æ“ä½œ Props

å¯ä»¥å¯¹ä¼ å…¥çš„ `props` è¿›è¡Œè¯»å– ä¿®æ”¹, æ·»åŠ æ–°å±æ€§ä»¥åŠåˆ é™¤æŸäº›å±æ€§, éœ€è¦æ³¨æ„çš„æ˜¯: ä¸åº”è¯¥å’Œä¼ å…¥çš„ `props` å±æ€§åæœ‰å†²çª

import PropsDemo from '@site/src/components/demos/PropDemo';

<PropsDemo />

### 2. æŠ½è±¡ state

å°†åŒ…è£¹ç»„ä»¶ä¸­çš„çŠ¶æ€æåˆ°åŒ…è£¹ç»„ä»¶ä¸­ æ¥å®ç°ä¸€ä¸ªå—æ§ç»„ä»¶(è‡ªåŠ¨æ³¨å…¥åŒå‘ç»‘å®š, åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ renderProps `() => <input />`)

import StateDemo from '@site/src/components/demos/StateDemo';

<StateDemo />

### 3. åŒ…è£¹å…¶ä»–å…ƒç´ 

æ¯”å¦‚ä¸€äº›æ ·å¼å¸ƒå±€é€šè¿‡å¤–å±‚æ·»åŠ å¤–å±‚å®¹å™¨å®ç°å¸ƒå±€

import { LayoutDemo } from '@site/src/components/demos/LayoutDemo';

<LayoutDemo />

### 4. è·å– ref å¼•ç”¨

#### å‡½æ•°ç»„ä»¶

æ™®é€šçš„å‡½æ•°ç»„ä»¶æ˜¯æ— æ³•é€šè¿‡ ref è·å–åˆ°ç»„ä»¶æœ¬èº«åŠç»„ä»¶å†…éƒ¨çš„æ–¹æ³•çš„

import FunctionRefDemo from '@site/src/components/demos/FunctionRefDemo';

<FunctionRefDemo />

#### class ç»„ä»¶

é€šè¿‡ `ref` è·å–åˆ°ç»„ä»¶å®ä¾‹, è°ƒç”¨ç»„ä»¶å®ä¾‹æ–¹æ³•

import ClassRefDemo from '@site/src/components/demos/ClassRefDemo';

<ClassRefDemo />

### 5.æ¡ä»¶æ¸²æŸ“

import { ConditionalProxy } from '@site/src/components/demos/ConditionalDemo';

<ConditionalProxy />

## åå‘ç»§æ‰¿

åœ¨å®šä¹‰å¸¸è§„`JS`ä¸­ `class`, [å®ä¾‹åŒ– class ä¸­çš„ static ä¼šè¢«ç»§æ‰¿å— ?](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes/static)

```ts
class A {
  constructor(width, height) {
    this.width = width;
    this.height = height;
  }
  static getDesc() {
    return 'This is A';
  }
}

class B extends A {
  constructor(width, height) {
    super(width, height);
  }
}

const b = new B(100, 10);
```

### åŒ…è£¹å…¶ä»–å…ƒç´ (ç»„åˆæ¸²æŸ“)

import { ReverseLayout } from '@site/src/components/demos/LayoutDemo';

<ReverseLayout />

### æ¡ä»¶æ¸²æŸ“

å¤šç”¨äºæƒé™æ§åˆ¶, ç™»å½•åˆ¤æ–­ç­‰

import { ReverseConditional } from '@site/src/components/demos/ConditionalDemo';

<ReverseConditional />

## å¯¹æ¯”

![å±æ€§ä»£ç†å’Œåå‘ç»§æ‰¿](../static/img/hoc.jpg)

---

## è‡ªå®šä¹‰ hooks

hooks åªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨, è§£å†³äº†åŸæœ¬å‡½æ•°ç»„ä»¶åªèƒ½ä½œä¸ºæ— çŠ¶æ€ç»„ä»¶æ¸²æŸ“

è‡ªå®šä¹‰å®ç°ä¼ªåŒå‘ç»‘å®š

import BindInput from '@site/src/components/demos/BindInput';

<BindInput />

- [DEMO](https://codesandbox.io/s/learn-hooks-0fosd): å¤§å¤šæ˜¯å®˜æ–¹ç¤ºä¾‹æ¼”ç¤º
- [codepen](https://codepen.io/niexiaofei/pen/GeWeXZ)
- [è‡ªå®šä¹‰ Hooks æµ‹è¯•](https://codesandbox.io/s/zidingyihooks-ceshi-c6wb2)
- [é¢„è§ˆæµ‹è¯•](https://bricksjs-hooks.surge.sh/#/./use-detail?anchor=%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95)
- [useDetail](https://github.com/bricksjs/hooks/blob/dev/src/useDetail/index.ts)

## æ³¨æ„äº‹é¡¹

[å®˜æ–¹æ–‡æ¡£](https://zh-hans.reactjs.org/docs/higher-order-components.html#caveats)

- åœ¨ç±»ç»„ä»¶ä¸­å¦‚æœåŒ…å«äº† `static` æ–¹æ³•, éœ€è¦è¿›è¡Œæ‹·è´, å¦åˆ™å°†ä¸ä¼šä¼ é€’ [æŸ¥çœ‹](https://zh-hans.reactjs.org/docs/higher-order-components.html#static-methods-must-be-copied-over), å¯ä»¥ä½¿ç”¨ [hoist-non-react-statics](https://github.com/mridgway/hoist-non-react-statics)è‡ªåŠ¨æ‹·è´
- Refs ä¸ä¼šè¢«ä¼ é€’: ç›´æ¥å°† ref ç»‘å®šåœ¨ WrappedComponent ç»„ä»¶ä¸Š, å®é™…ä¸Šåªèƒ½è·å–åˆ° WrappedComponent(å¦‚æœæ˜¯ç±»ç»„ä»¶çš„è¯)å®ä¾‹,è€Œä¸èƒ½è·å–åˆ°åŸç»„ä»¶å†…çš„ ref ç»‘å®š, [å‚è€ƒ class ç»„ä»¶è·å– Ref](#class-ç»„ä»¶)
- ä¸åº”åœ¨ `render` ä¸­è°ƒç”¨é«˜é˜¶ç»„ä»¶, æ¯æ¬¡è¿”å›çš„ç»„ä»¶æ˜¯ä¸ç›¸åŒçš„, å¯¼è‡´æ¯æ¬¡éƒ½ä¼šè¿›è¡Œæ–°çš„ç”Ÿå‘½å‘¨æœŸå¾ªç¯
- å¤åˆ¶ displayName, å¦‚æœä½¿ç”¨äº† react-devtool è°ƒè¯•å·¥å…·çš„è¯

## ç¼ºç‚¹

- å¤§é‡ä½¿ç”¨ HOC, è°ƒç”¨å›°éš¾, æ³¨å…¥æ•°æ®éš¾ä»¥æ’æŸ¥å…·ä½“æ¥æº
- å¤šä¸ªé«˜é˜¶ç»„ä»¶æ··åˆä½¿ç”¨æ—¶, å¯èƒ½ä¼šå‡ºç°å˜é‡åå†²çªé—®é¢˜

## å‚è€ƒé“¾æ¥

- [ã€Reactæ·±å…¥ã€‘ä»Mixinåˆ°HOCå†åˆ°Hook](https://juejin.cn/post/6844903815762673671)
- [Reacté«˜é˜¶ç»„ä»¶(HOC)çš„å…¥é—¨ğŸ“–åŠå®è·µ](https://juejin.cn/post/6844904050236850184)
- [React é«˜é˜¶ç»„ä»¶(HOC)å…¥é—¨æŒ‡å—](https://juejin.cn/post/6844903477798256647)
- [Render Props](https://react.docschina.org/docs/render-props.html): å®˜æ–¹æ–‡æ¡£
- [React Hooks ä¹‹äº HoC ä¸ Render Props](https://zhuanlan.zhihu.com/p/62791765)
- [React Hooks æœ€ä½³å®è·µ](https://react.docschina.org/blog/2020/05/22/react-hooks.html)
- [React Higher Order Components in 3 minutes](https://codeburst.io/higher-order-components-in-3-minutes-93173b2ebe52): [ã€è¯‘ã€‘ä¸‰åˆ†é’ŸæŒæ¡ React é«˜é˜¶ç»„ä»¶](https://segmentfault.com/a/1190000019153177)
- [å¸¦ç€ä¸‰ä¸ªé—®é¢˜æ·±å…¥æµ…å‡ºReacté«˜é˜¶ç»„ä»¶](https://juejin.cn/post/6844903491425533959)
<!-- - [æ·±å…¥React æŠ€æœ¯æ ˆ](https://github.com/jiandanaiyici/frontend-resource/blob/master/React/%E6%B7%B1%E5%85%A5REACT%E6%8A%80%E6%9C%AF%E6%A0%88%20.pdf): 81 ~ 97é¡µ -->
- [Do Hooks replace render props and higher-order components](https://reactjs.org/docs/hooks-faq.html#do-hooks-replace-render-props-and-higher-order-components)
- [è£…é¥°å™¨](https://es6.ruanyifeng.com/#docs/decorator)
- [Awesome React Hooks: React Hooks ç›¸å…³æ¸…å•](https://github.com/glauberfc/awesome-react-hooks#readme)

<!--
- [Proxy](https://es6.ruanyifeng.com/#docs/proxy)
- [React å¸¸è§çš„ 15 ä¸ªé—®é¢˜](https://zhuanlan.zhihu.com/p/56663053)
https://zhuanlan.zhihu.com/p/85969406
https://juejin.cn/post/6844903477798256647
https://github.com/MrErHu/React-Advanced-Guides-CN
https://zxuqian.cn/docs/videos/react/react-props-button

-->

<!--truncate-->
