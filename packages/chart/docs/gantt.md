---
id: gantt
title: 甘特图
sidebar_label: 甘特图
---


#### Bizcharts

> 当时看到这个需求时并没有开发过类似的 📈, 感觉有些懵逼的状态, 不过目前基本上所有的图表图都支持使用甘特图, 而甘特图的特性就是以多个任务作为 Y 轴, 而时间作为 X 轴, 以便方便查看不同任务的执行时间, 需求呢就是一个以根据数值判断的一个等级的左侧 Y 轴甘特图, 另一个是以数值作为右侧 Y 轴的一个趋势图, 项目中使用的是 bizcharts 这里就先以 bizcharts 作为第一个实现的版本

根据 bizcharts 数据的格式定义为平铺的任务列表

```ts
// 数据格式
const data = [
  {
    task: '任务',
    startDate: '开始时间',
    endDate: '结束时间',
    value: '数值',
  },
];
```

而上方的数据格式并不是我们目前需要的格式, 因为缺少了一个等级的区分

```ts
const getChartDataByRangeAndLevel = () =>
  '返回的是处理了带有时间范围以及等级的字符串';
```

你以为到这里就已经结束了吗 ?, 远远不够, 如果你使用过 bizcharts 或者 g2 就会知道图表的颜色基本上都是使用内置的, 当然也可以使用自定义的颜色, 恰恰需求中就包含了这一项, 需要对所有的等级进行对标指定颜色, 所以又需要一轮的处理数据(无论是否是 React 组件特性, 我们都需要将数据处理以及 UI 渲染独立分开, 这样才能更好的达到一个比较合理通用性的组件, 虽然这里不够场景通用, 但符合业务通用其实目前来说就已经够了)

```ts
const getLastDataWithColors = (list: any[]) =>
  '返回的是一个已经经过排序以及记录所有出现过的等级必须要是指定的等级 以及等级对应的颜色的对象';
```

结束了吗 ? 还没有, 其实我们忽略了一点, 虽然对数据以及颜色进行了指定, 但是根据内部渲染的机制会将左侧甘特图的 Y 轴在渲染时比较难以控制, 所以还需要进一步的控制 `Y`轴的刻度线

```ts
// 根据配置 API 进行 formatter 显示文本 以及 刻度线处理
const getLastScale = () => '返回的是符合 bizcharts Y轴刻度线的设置';
```

当然这里同时也设置了 `Legend` 图例设置(根据项目等级设置), 以为到这里已经结束了吗, 其实如果真的需要满足需求中所有的问题还没有, 这只是满足了 `80%`左右的需求, 还有其他不算是比较复杂的交互, 比如控制 图例(除了项目等级的图例 还需要添加上折线图的实例 这个实现有些麻烦, 因为需要不同的刻度字段来配置, 目前还未实现, 具体的可以再次参考 bizchart 的 API 进行设置, 当然这里可以使用 React 组件自定义一个定位至指定地方, 但这无疑是增加了交互体验难度, 比如: 点击图例需要对图表上已经绘制的部分进行隐藏以及展示的交互)

当然这里目前还是存在很大的 `bug`, 比如: 点击图例之后图表样式错乱以及数据显示不全问题 以及显示 `Tooltip` 时的自定义展示内容 和 `hover` 图表的位置控制展示内容

[具体的可参考 `src/pages/charts/GanttChart/helper.ts`](https://github.com/niexiaofei1988/demos/tree/master/umi-demo/src/pages/charts/GanttChart/helper.ts)

[查看实现效果: 目前还有很大的 bug](https://www.yuque.com/docs/share/fd70794e-38e3-41e5-b02a-75e2db046413?#《甘特图》)
